<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="property_reservation_tree" model="ir.ui.view">
        <field name="name">property.reservation.tree</field>
        <field name="model">property.reservation</field>
        <field name="arch" type="xml">
            <tree>
                <field name="reservation_seq"/>
                <field name="partner_id"/>
                <field name="reservation_date"/>
                <field name="state" decoration-info="state == 'sale_offer'" decoration-success="state == 'reserve'"
                       decoration-danger="state == 'cancel'" widget="badge"/>
            </tree>
        </field>
    </record>
    <!--    Parking Form View-->
    <record id="property_reservation_form" model="ir.ui.view">
        <field name="name">property.reservation.form</field>
        <field name="model">property.reservation</field>
        <field name="arch" type="xml">
            <form string="Property Reservation">
                <header>
                    <button name="action_reserve" class="oe_highlight" states="sale_offer" string="Reserve"
                            type="object"/>
                    <button name="action_reset_draft" states="cancel,reserve"
                            string="Reset to Sales Offer" type="object"/>
                    <button name="%(reservation_cancel_action)d" string="Cancel" data-hotkey="l" title="Cancel"
                            type="action" context="{'default_reservation_id': active_id}"
                            attrs="{'invisible':[('state', '=', 'cancel')]}"/>

                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object"
                                name="action_lead" string="Lead" icon="fa-file"
                                attrs="{'invisible': [('lead_id', '=', False)]}"
                        >
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="reservation_seq" placeholder="e.g. Reservation"/>
                        </h1>
                    </div>

                    <group>
                        <group string="Reservation">
                            <field name="partner_id" required="1"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="building_id" required="1"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="unit_id" domain="[('id','in',unit_ids)]" required="1"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="unit_type_id" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="terms_conditions_id" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="payment_term_id" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="parking_reservation_ids" widget="many2many_tags" invisible="1"/>
                        </group>
                        <group string="Amounts">
                            <field name="amount_untaxed" widget='monetary' readonly="1"
                                   options="{'currency_field': 'currency_id'}"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="tax_ids" widget="many2many_tags"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="amount_total" widget='monetary'
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="tax_amount" invisible="1"/>
                            <field name="installation_amount" widget='monetary'
                                   options="{'currency_field': 'currency_id'}" readonly="1"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="remaining_amount" widget='monetary'
                                   options="{'currency_field': 'currency_id'}"
                                   readonly="1"/>
                            <field name="company_id" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                        </group>
                        <group string="Price Info">
                            <field name="unit_sales_price" readonly="1"/>
                            <field name="sales_price" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="parking_price" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="lead_id" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="unit_ids" invisible="1"/>
                        </group>
                        <group string="Dates">
                            <field name="reservation_date" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="enquiry_date" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="offer_valid_date" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                            <field name="sale_date" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="Terms &amp; Conditions" String="Terms &amp; Conditions">
                            <field name="notes" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                        </page>
                        <page name="Payment Terms" String="Payment Terms">
                            <field name="payment_terms" attrs="{'readonly':[('state','not in',['sale_offer'])]}"/>
                        </page>
                        <page name="Payment Plans" string="Payment Plans">
                            <field name="payment_plan_ids"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}">
                                <tree editable="bottom">
                                    <field name="due_date"/>
                                    <field name="percent" required="1"/>
                                    <field name="amount_untaxed" widget='monetary'
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="amount_taxed" widget='monetary'
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="amount_total" widget='monetary'
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="currency_id" invisible="1"/>
                                    <field name="company_id" invisible="1"/>
                                    <field invisible="1" name="reservation_id"/>
                                </tree>
                            </field>
                        </page>
                        <page name="Parking Slots" string="Parking Slots">
                            <field name="parking_line_ids" domain="[('id', 'in', parking_ids)]" widget="one2many_list"
                                   attrs="{'readonly':[('state','not in',['sale_offer'])]}">
                                <tree string="Parking Slot">
                                    <field name="parking_no"/>
                                    <field name="sales_price"/>
                                    <field name="state" widget="badge"/>
                                </tree>
                            </field>
                            <field name="parking_ids" invisible="1"/>
                        </page>
                        <page name="specifications" string="Specifications">
                            <field name="specifications" readonly="1"/>
                        </page>
                        <page name="report_template" string="Report Template">
                            <field name="report_template"/>
                        </page>
                        <page name="signatures" string="Signatures">
                            <separator string="Witness"/>
                            <field name="witness_signature" attrs="{'readonly':[('state','not in',['reserve'])]}"
                                    widget="signature"/>
                            <separator string="Dev"/>
                            <field name="dev_signature" attrs="{'readonly':[('state','not in',['reserve'])]}"
                                    widget="signature"/>
                            <separator string="Partner"/>
                            <field name="partner_sign" attrs="{'readonly':[('state','not in',['reserve'])]}"
                                    widget="signature"/>
                        </page>
                        <page string="Documents">
                            <field name="doc_ids" widget="one2many_list">
                                <tree string="Documents" editable="bottom" sample="1">
                                    <field name="name"/>
                                    <field name="doc_no"/>
                                    <field name="doc_type"/>
                                    <field name="doc_dec"/>
                                    <field name="attachment_ids" widget="many2many_binary"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>
    <!--    window action for Reservation-->
    <record id="action_reservation" model="ir.actions.act_window">
        <field name="name">Property Reservation</field>
        <field name="res_model">property.reservation</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Property Reservation
            </p>
        </field>
    </record>

    <record id="res_config_settings_view_form" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.reservation</field>
        <field name="model">res.config.settings</field>
        <field name="priority" eval="45"/>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('settings')]" position="inside">
                <div class="app_settings_block" data-string="reservation" string="Property Reservation"
                     groups="property_reservation.group_reservation_user_own" data-key="property_reservation">
                    <div class="row mt16 o_settings_container">
                        <div class="col-xs-12 o_setting_box">
                            <h2>Report Template</h2>
                            <group>
                                <group>
                                    <field name="report_template" widget="html"/>
                                </group>
                            </group>
                        </div>
                    </div>
                     <div class="row mt16 o_settings_container">
                        <div class="col-xs-12 o_setting_box">
                            <h2>Journal </h2>
                            <group>
                                <group>
                                    <field name="journal_id"/>
                                </group>
                            </group>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <record id="action_reservation_config" model="ir.actions.act_window">
        <field name="name">Settings</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="target">inline</field>
        <field name="context">{'module' : 'property_reservation'}</field>
    </record>
    <!--Reservation Menu -->
    <menuitem id="reservation_main_menu" name="Reservation"
              web_icon="property_reservation,static/description/odoo_icon.png"
              groups="group_reservation_user_own"
    />

    <menuitem id="reservation_menu" name="Property Reservation" parent="reservation_main_menu"
              action="action_reservation" sequence="30"/>
    <menuitem id="reservation_config_menu" name="Configuration" parent="reservation_main_menu"
              sequence="60"/>
    <menuitem id="reservation_settings_menu" name="Settings" parent="reservation_config_menu"
              sequence="30" action="action_reservation_config"/>
</odoo>