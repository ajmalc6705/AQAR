<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="view_task_form2_inherited" model="ir.ui.view">
        <field name="name">project.task.form.inherit.task.property</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_ids']" position="after">
                <field name="type_of_task"/>
                <field name="is_assignment" invisible="1"/>
                <field name="project_ids" invisible="1"/>
                <field name="building_id" attrs="{'invisible':[('type_of_task','!=','property')]}"/>
                <field name="property_id" attrs="{'invisible':[('type_of_task','!=','property')]}"/>
            </xpath>
            <xpath expr="//field[@name='project_id']" position="replace">
                <field name="project_id" placeholder="Private"
                       domain="[('active', '=', True), ('company_id', '=', company_id),('id','in',project_ids)]"
                       attrs="{'invisible': [('parent_id', '!=', False)]}" widget="project_private_task"/>
            </xpath>
            <xpath expr="//field[@name='analytic_account_id']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_assignment', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='task_properties']" position="attributes">
                <attribute name="attrs">{'invisible': ['|',('is_assignment', '=', True),('project_id', '=', False)]}
                </attribute>
            </xpath>
        </field>
    </record>

    <!--    Project form view for assignment-->
    <record id="view_edit_project_inherit_form_assignment" model="ir.ui.view">
        <field name="name">project.project.view.inherit.assignment</field>
        <field name="model">project.project</field>
        <field name="inherit_id" ref="project.edit_project"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_start']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_assignment', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='date']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_assignment', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//label[@for='date_start']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_assignment', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//div[@name='dates']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_assignment', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="is_assignment" invisible="1"/>
            </xpath>
            <xpath expr="//page[@name='settings']" position="inside">
                <attribute name="groups">project.group_project_manager</attribute>
                <attribute name="groups">aqar_project_assignment.group_assignment_manager_own</attribute>
            </xpath>
        </field>
    </record>

    <record id="action_assignment" model="ir.actions.act_window">
        <field name="name">Assignment</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.project</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="domain">[('is_assignment','=',True)]</field>
        <field name="context">
            {
            'default_is_assignment': True,
            }
        </field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Project Assignments
            </p>
        </field>
    </record>

    <record id="action_assignment_tasks" model="ir.actions.act_window">
        <field name="name">Assignment Tasks</field>
        <field name="res_model">project.task</field>
        <field name="view_mode">kanban,tree,form,calendar,pivot,graph,activity</field>
        <field name="type">ir.actions.act_window</field>
        <field name="domain">[('is_assignment','=',True),('user_ids', 'in', uid)]</field>
        <field name="context">
            {
            'default_is_assignment': True,
            }
        </field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Project Assignments
            </p>
        </field>
    </record>

    <record id="project.action_view_all_task" model="ir.actions.act_window">
        <field name="domain">[('is_assignment','=',False)]</field>
    </record>

    <record id="project.open_view_project_all" model="ir.actions.act_window">
        <field name="domain">[('is_internal_project', '=', False),('is_assignment','=',False)]</field>
    </record>

    <menuitem id="assignment_main_menu" name="Assignment" groups="group_assignment_user_own"
              web_icon="aqar_project_assignment,static/description/odoo_icon.png"/>
    <menuitem id="assignment_menu" name="Assignment" parent="assignment_main_menu" action="action_assignment"/>
    <menuitem id="assignment_task_menu" name="Assignment Tasks" parent="assignment_main_menu"
              action="action_assignment_tasks"/>


</odoo>