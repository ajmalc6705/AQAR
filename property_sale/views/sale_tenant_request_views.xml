<?xml version="1.0" encoding="UTF-8" ?>
<odoo>


    <record id="view_sale_tenant_request_tree" model="ir.ui.view">
        <field name="name">sale.tenant.request.tree</field>
        <field name="model">tenant.request</field>
        <field name="arch" type="xml">
            <tree string="Customer Requests" sample="1" decoration-info="(state == 'draft')"
                  default_order="sequence desc"
            >
                <field name="sequence" string="Reference"/>
                <field name="partner_id"/>
                <field name="property_sale_id"/>
                <field name="building_id"/>
                <field name="from_date" optional="hide"/>
                <field name="to_date" optional="hide"/>
                <field name="no_of_month" optional="hide"/>

                <field name="request_type"/>
                <field name="company_id" optional="hide"/>
                <field name="state"
                       decoration-info="(state == 'draft')"
                       decoration-success="state == 'approved'"
                       decoration-muted="(state  == 'Property Head')"
                       decoration-primary="(state == 'Accountant')"
                       decoration-danger="(state == 'refused')"
                       widget="badge" optional="show"/>
            </tree>
        </field>
    </record>


    <record id="view_sale_tenant_request_form" model="ir.ui.view">
        <field name="name">sale.tenant.request.form</field>
        <field name="model">tenant.request</field>
        <field name="arch" type="xml">
            <form string="Customer Requests">
                <header>
                    <field name="accountant_button" invisible="1"/>
                    <field name="approve_button" invisible="1"/>
                    <field name="renew_button_visibility" invisible="1"/>
                    <button name="move_to_sales_head" string="Send to Property Head"
                            type="object" class="oe_highlight"
                            groups="property_lease_management.group_property_user"
                            states="draft"/>
                    <button name="sales_head_approve" string="Send to Accountant" type="object"
                            class="oe_highlight"
                            groups="property_lease_management.group_property_head"
                            attrs="{'invisible':[('accountant_button','!=', True)]}"/>
                    <button name="renewal_approve" string="Approve" type="object"
                            class="oe_highlight"
                            attrs="{'invisible':[('approve_button','!=', True)]}"/>
                    <button name="accountant_approve" string="Approve" type="object"
                            class="oe_highlight"
                            groups="property_lease_management.group_property_accountant"
                            states="Accountant"/>
                    <button name="send_back" string="Send Back" type="object"
                            class="oe_highlight"
                            groups="property_lease_management.group_property_accountant"
                            states="Accountant"/>
                    <button name="send_back_renewal" string="Send Back" type="object"
                            class="oe_highlight"
                            groups="property_lease_management.group_property_head"
                            states="Property Head"/>
                    <button name="move_to_refuse" string="Reject" type="object"
                            class="oe_highlight"
                            groups="property_lease_management.group_property_head,property_lease_management.group_property_accountant"
                            states="Property Head,Accountant"/>
                    <button name="send_email_document"
                            string="Send Email Document"
                            type="object"
                            attrs="{'invisible':[('renew_button_visibility', '!=', True)]}"
                            class="oe_highlight"/>
                    <button name="print_renewal_commercial" string="Print Renewal Commercial"
                            type="object" class="oe_highlight"/>
                    <!--                         attrs="{'invisible':[('renew_button_visibility', '!=', True)]}"-->
                    <button name="print_renewal_sanad"
                            string="Print Renewal Sanad"
                            type="object"
                            attrs="{'invisible':[('renew_button_visibility', '!=', True)]}"
                            class="oe_highlight"/>
                    <button name="renew_contract"
                            string="Renew Contract"
                            type="object"
                            groups="property_lease_management.group_property_head,property_lease_management.group_property_user"
                            attrs="{'invisible':[('renew_button_visibility', '!=', True)]}"
                            class="oe_highlight"/>
                    <field name="state" widget="statusbar"
                           attrs="{'invisible':[('request_type','=', 'Renewal Request')]}"
                           statusbar_visible="draft,Property Head,Accountant"/>
                    <field name="state_renewal" widget="statusbar"
                           attrs="{'invisible':[('request_type','!=', 'Renewal Request')]}"
                           statusbar_visible="draft,Property Head"/>
                </header>
                <sheet>
                    <field name="send_back_flag" invisible="1"/>
                    <widget name="web_ribbon" title="Send Back" bg_color="bg-info"
                            attrs="{'invisible': [('send_back_flag', '=', False)]}"/>

                    <div class="oe_title">
                        <label for="sequence" class="oe_edit_only" string="Ref"/>
                        <h1>
                            <field name="sequence" class="oe_inline" nolabel="1"/>
                        </h1>
                    </div>
                    <group>
                        <group>

                            <field name="partner_id" string="Customer"
                                   domain="[('tenant','=',False), ('parent_id', '=', False)]"
                                   context="{'default_company_id':company_id,'default_landlord':0, 'default_tenant':1,'show_address': 1}"
                                   attrs="{'readonly':[('state','==', 'approved')]}"/>
                            <field name="property_sale_id"
                                   domain="[('partner_id','=',partner_id)]"
                                   options="{'no_create_edit':True,'no_open':False,'no_edit':True,'no_create':True}"
                                   attrs="{'required':[('is_property_sale','==', True)], 'invisible':[('is_property_sale','!=', True)], 'readonly':[('state','==', 'approved')]}"
                            />
                            <field name="building_id" readonly="1" force_save="1"/>
                            <field name="request_type" readonly="0" />
                            <field name="is_property_sale" invisible="1" readonly="1"/>
                            <field name="company_id" invisible="0" readonly="1"
                                   options="{'no_create_edit':True,'no_open':True,'no_edit':True,'no_create':True}"
                            />

                        </group>

                        <!--      Cheque Holding                      -->
                        <group string="Cheque Holding">
                            <field name="from_date" attrs="{'readonly':[('state','==', 'approved')]}"/>
                            <field name="to_date" attrs="{'readonly':[('state','==', 'approved')]}"/>
                            <field name="no_of_month" attrs="{'readonly':[('state','==', 'approved')]}"/>
                        </group>


                    </group>
                    <group>
                        <field name="tenant_reason"/>
                    </group>
                    <notebook>
                        <page name="signature" string="E-Signature">
                            <field name="tenant_esignature_ids">
                                <tree editable="bottom" sample="1">
                                    <field name="signature_template"/>
                                    <field name="partner_ids" widget="many2many_tags"/>
                                </tree>
                            </field>
                        </page>
                        <page name="renewal" string="Approvals"
                              attrs="{'invisible':[('request_type','!=', 'Renewal Request')]}">
                            <group>
                                <group string="Property Head Approval">
                                    <field name="p_head_approved_by"
                                           readonly="1"
                                           string="Approved User"/>
                                    <field name="p_head_approved_date"
                                           readonly="1"
                                           string="Approved Date"/>
                                </group>
                                <group string="Approval Dates">
                                    <field name="commercial_approved_date"/>
                                    <field name="sanad_approved_date"/>
                                    <field name="sanad_tenant_date"/>
                                </group>
                            </group>
                        </page>
                        <page name="document_ids" string="Additional Documents"
                              attrs="{'invisible':[('request_type','!=', 'Renewal Request')]}">
                            <field name="doc_ids">
                                <tree string="Documents" editable="bottom" sample="1">
                                    <field name="doc_no"/>
                                    <field name="name" readonly="1"/>
                                    <field name="doc_type" readonly="1"/>
                                    <field name="doc_dec" readonly="1"/>
                                    <field name="issue_date" readonly="1"/>
                                    <field name="expiry_date" readonly="1"/>
                                    <field name="file_name" invisible="1"/>
                                    <field name="attachment_ids" readonly="1" filename="file_name"
                                           widget="many2many_tags"/>
                                </tree>
                            </field>
                            <!--                                <group>-->
                            <!--                                    <group>-->
                            <!--                                        <field name="doc_type"/>-->
                            <!--                                    </group>-->
                            <!--                                    <group>-->
                            <!--                                        <button name="onchange_doc_type" type="object"-->
                            <!--                                                class="oe_highlight"-->
                            <!--                                                string="Fetch Documents"/>-->
                            <!--                                    </group>-->
                            <!--                                </group>-->
                            <!--                                <field name="attachment_details" create="false" edit="false">-->
                            <!--                                    <tree string="Documents" create="false" edit="false">-->
                            <!--                                        <field name="doc_type"/>-->
                            <!--                                        <field name="doc_no"/>-->
                            <!--                                        <field name="doc_dec"/>-->
                            <!--                                        <field name="file_name" invisible="1"/>-->
                            <!--                                        <field name="attachment_ids" filename="file_name"/>-->
                            <!--                                    </tree>-->
                            <!--                                </field>-->
                        </page>
                        <page name="Cheque Details" string="Cheque Details"
                              attrs="{'invisible':[('request_type','!=', 'Cheque holding')]}">
                            <field name="check_ids">
                                <tree editable="bottom" sample="1">
                                    <field name="check_no"/>
                                    <field name="check_bearer"/>
                                    <field name="check_date"/>
                                </tree>
                            </field>
                        </page>
                        <page name="remarks" string="Remarks">
                            <group>
                                <group>
                                    <field name="sales_remarks"
                                           attrs="{'readonly':[('state','!=', 'draft')]}"/>
                                    <field name="sales_head_remarks"
                                           attrs="{'readonly':[('state','!=', 'Property Head')]}"/>
                                    <field name="accountant_remarks"
                                           attrs="{'readonly':[('state','!=', 'Accountant')]}"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>


    <!-- Window action for tenant requests from Community-->
    <record id="action_view_sale_tenant_request" model="ir.actions.act_window">
        <field name="name">Customer Request</field>
        <field name="res_model">tenant.request</field>
        <field name="view_ids" eval="[(5, 0, 0),
                (0, 0, {'view_mode': 'tree', 'view_id': ref('property_sale.view_sale_tenant_request_tree')}),
                (0, 0, {'view_mode': 'form', 'view_id': ref('property_sale.view_sale_tenant_request_form')})]"/>
        <field name="domain">[('is_property_sale', '=', True)]</field>
        <field name="context">{ 'default_request_type': 'Cheque holding','default_is_property_sale': True, }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Click to create a New Tenant Request.
            </p>
        </field>
    </record>


    <!-- Menu item from Community -->
    <menuitem id="menu_action_view_community_tenant_request" name="Customer Request"
              parent="property_sale.property_sale_main_menu"
              sequence="50" action="property_sale.action_view_sale_tenant_request"
    />


</odoo>